---
title: "Research Report"
author:
- name: Ihsan Kahveci
  affiliation: University of Washington
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    toc: yes
    toc_float: yes
    code_folding: show
  word_document:
    toc: yes
subtitle: 'Network Frailty and Herd Immunity'
bibliography: references.bib
---

```{r setup, include=FALSE}
## Set knitr options here
knitr::opts_chunk$set(echo = FALSE,
                      comment = NA, 
                      cache = TRUE,
                      warning = FALSE,
                      message = FALSE, 
                      cache.lazy = FALSE
                      )

```

```{css, echo = FALSE}
caption {
      color: black;
      font-weight: bold;
      font-size: 1.0em;
}
```

```{r libraries, include=FALSE}
## Load libraries
library(sna)
library(dplyr)
library(purrr)
library(ggplot2)
options(scipen = 999)
```

## Introduction


$$\bar{k} = \frac{\sum_i k_i}{n} =  \frac{2m}{n}$$

$$ d(G)^u = \bar{k} \times \frac{1}{n-1} =  \frac{\bar{k}}{n-1}$$
k:average degree, d:density



```{r}
size_range = seq(100,1000, 10)
random_graphs = list()
for (size in size_range){
  mean_degrees = 6:20
  total = length(mean_degrees)*100
  densities = mean_degrees/(size-1)
  graphs = rgraph(n=size, m=total, mode="graph", tprob=densities, return.as.edgelist = TRUE)
  random_graphs = c(random_graphs, graphs)
}
names(random_graphs) <- paste0("network", 1:length(random_graphs))
```





```{r}
hist(sapply(lapply(random_graphs, degree, gmode="graph"), mean), xlab="mean degree", main="")
```

```{r}
degree_attack <- function(g, inverse = FALSE){
  d = degree(g, gmode = "graph")
  n = length(d)
  if(inverse == FALSE) weights = d/sum(d)
  else weights = sum(d)/(d + 0.00000001)
  nodes = sample(n, n/4, prob = weights)
  for (node in nodes){
    inds = which(g[,1] == node)
    if(length(inds) == 0) next #in case the node has no edges
    ind = sample(inds, 1)
    adj = g[ind, 2]
    ind.2 = which(g[,1] == adj & g[,2] == node) #find the symmetric row
    g[c(ind, ind.2),3] = 0  
  }
  return(g)
}
  
```

note: collapse graph for removing the single way edges 



Simulating degree attack both forwards and backwards

```{r}
out = lapply(random_graphs, degree_attack)
out_inv = lapply(random_graphs, degree_attack, inverse = TRUE)
```


Running community detection to calculate the number of bridge nodes per graph..

```{r}
frailty = cutpoints(out, mode = "graph") %>% map_dbl(length)
frailty_inv = cutpoints(out_inverse, mode = "graph") %>% map_dbl(length)
```


Creating a data_frame for visualizations.

```{r}
avg_degree = sapply(lapply(out, degree, gmode="graph"), mean)
avg_degree_inv = sapply(lapply(out_inv, degree, gmode="graph"), mean)

graphs_df = tibble(graph = 1:length(out), frailty, frailty_inv, avg_degree, avg_degree_inv)
```


```{r}
graphs_df %>%
  ggplot(aes(x=avg_degree, y=frailty)) +
  geom_point() +
  geom_smooth()
```



## Code Appendix


```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}

```

## References

