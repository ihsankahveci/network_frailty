---
title: "Research Report"
author:
- name: Ihsan Kahveci
  affiliation: University of Washington
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    toc: yes
    toc_float: yes
    code_folding: show
  word_document:
    toc: yes
subtitle: 'Network Frailty and Herd Immunity'
bibliography: references.bib
---

```{r setup, include=FALSE}
## Set knitr options here
knitr::opts_chunk$set(echo = FALSE,
                      comment = NA, 
                      cache = TRUE,
                      warning = FALSE,
                      message = FALSE, 
                      cache.lazy = FALSE
                      )

```

```{css, echo = FALSE}
caption {
      color: black;
      font-weight: bold;
      font-size: 1.0em;
}
```

```{r libraries, include=FALSE}
## Load libraries
library(sna)
library(dplyr)
library(purrr)
```

## Introduction


$$\bar{k} = \frac{\sum_i k_i}{n} =  \frac{2m}{n}$$

$$ d(G)^u = \bar{k} \times \frac{1}{n-1} =  \frac{\bar{k}}{n-1}$$
k:average degree, d:density

```{r}
n = 300
mean_degrees = 6:20
total = length(mean_degrees)*10
densities = mean_degrees/(n-1)

```


```{r}
random_graphs = rgraph(n=n, m=total, mode="graph", tprob=densities)
random_graphs = apply(random_graphs, 1, network)
names(random_graphs) <- paste0("network", 1:length(random_graphs))
```


```{r}
hist(sapply(lapply(random_graphs, degree, gmode="graph"), mean), xlab="mean degree", main="")
```

```{r}
degree_attack <- function(graphs, inverse = FALSE){
  i=1
  out = vector(mode = "list", length = length(graphs))
  for (g in graphs){
    n = network.size(g)
    degree = degree(g, gmode = "graph")
    if(inverse == FALSE){
      weights = degree/sum(degree)
    }else{
      weights = sum(degree)/(degree + 0.00000001)
    }
    nodes = sample(1:n, n/4,  prob = weights)
    for (node in nodes){
      edges = get.edgeIDs(g, v = node)
      if(length(edges) == 0) next
      remove = sample(edges, size = 1)
      delete.edges(g, remove)
    }
    out[[i]] <- g
    i = i+1
  }
  names(out) = paste0("network", 1:length(graphs))
  return(out)
}
  
```


Simulating degree attack both forwards and backwards

```{r}
out = degree_attack(random_graphs, inverse = FALSE)
out_inverse = degree_attack(random_graphs, inverse = TRUE)
```


Running community detection to find the bridge nodes.

```{r}
comps = component.dist(out)
comps_inv = component.dist(out_inverse)
```

Calculating the mean values  

```{r}
map(test, ~map_at(., c(1,3), mean))
```




## Code Appendix


```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}

```

## References

